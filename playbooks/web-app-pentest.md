# Web Application Penetration Testing Playbook

## Overview
This playbook provides a systematic approach to web application security testing using CyberKit tools.

## Prerequisites
- CyberKit Docker container running
- Target web application URL
- API keys configured (Shodan, VirusTotal)
- Proper authorization to test the target

## Phase 1: Reconnaissance

### 1.1 Initial Discovery
```bash
# Basic reconnaissance
./offensive/webapp-scan.sh -t target.com -o /home/cyberkit/engagements/webapp-test

# Enhanced reconnaissance with API integration
./offensive/webapp-scan.sh -t target.com --shodan --virustotal --securitytrails

# Manual subdomain enumeration
subfinder -d target.com -o subdomains.txt
amass enum -d target.com -o amass-results.txt
```

### 1.2 Technology Stack Identification
```bash
# Web technology fingerprinting
whatweb target.com
httpx -u target.com -tech-detect

# Check for common frameworks and CMS
nuclei -u target.com -tags tech
```

### 1.3 Directory and File Discovery
```bash
# Directory brute-forcing
gobuster dir -u https://target.com -w /usr/share/wordlists/dirb/common.txt -o directories.txt

# File extension discovery
ffuf -u https://target.com/FUZZ -w /usr/share/seclists/Discovery/Web-Content/common.txt -o files.json

# API endpoint discovery
ffuf -u https://target.com/api/FUZZ -w /usr/share/seclists/Discovery/Web-Content/api/api-endpoints.txt
```

## Phase 2: Vulnerability Assessment

### 2.1 Automated Vulnerability Scanning
```bash
# Nuclei comprehensive scan
nuclei -u target.com -severity critical,high,medium -o nuclei-vulns.txt

# Web application specific templates
nuclei -u target.com -tags sqli,xss,rce,lfi -o web-vulns.txt

# SSL/TLS assessment
nuclei -u target.com -tags ssl,tls -o ssl-assessment.txt
```

### 2.2 SQL Injection Testing
```bash
# SQLMap automated testing
sqlmap -u "https://target.com/login.php" --forms --batch --level=3 --risk=2

# Manual parameter testing
sqlmap -u "https://target.com/search.php?q=test" --batch --dbs

# Time-based SQL injection
sqlmap -u "https://target.com/product.php?id=1" --technique=T --batch
```

### 2.3 Cross-Site Scripting (XSS) Testing
```bash
# XSS scanner using nuclei
nuclei -u target.com -tags xss -o xss-results.txt

# Manual payload testing (use Burp Suite for advanced testing)
# See /home/cyberkit/engagements/webapp-test/resources/burp-setup.txt
```

## Phase 3: Authentication & Authorization Testing

### 3.1 Login Mechanism Analysis
```bash
# Brute force protection testing
hydra -l admin -P /usr/share/wordlists/rockyou.txt target.com http-post-form "/login:username=^USER^&password=^PASS^:Invalid"

# Default credential testing
nuclei -u target.com -tags login,default-creds
```

### 3.2 Session Management Testing
```bash
# Session fixation and hijacking tests
# (Manual testing required - use Burp Suite)

# JWT token analysis (if applicable)
# Check for weak JWT secrets and algorithm confusion
```

## Phase 4: Business Logic Testing

### 4.1 Input Validation Testing
```bash
# File upload vulnerabilities
nuclei -u target.com -tags upload,file

# Parameter pollution testing
# (Manual testing with various payloads)
```

### 4.2 Rate Limiting and CAPTCHA Bypass
```bash
# Rate limiting tests
# (Manual testing required)

# CAPTCHA analysis
# (Manual analysis and bypass attempts)
```

## Phase 5: Advanced Testing

### 5.1 Server-Side Request Forgery (SSRF)
```bash
# SSRF detection
nuclei -u target.com -tags ssrf

# Internal network scanning via SSRF
# (Manual testing with payloads)
```

### 5.2 XML External Entity (XXE) Testing
```bash
# XXE vulnerability detection
nuclei -u target.com -tags xxe

# Manual XXE payload testing
# (Use Burp Suite for payload delivery)
```

### 5.3 Deserialization Vulnerabilities
```bash
# Deserialization bug detection
nuclei -u target.com -tags deserialization

# Language-specific deserialization tests
# (Java, .NET, Python, PHP)
```

## Phase 6: Client-Side Security

### 6.1 JavaScript Analysis
```bash
# Extract and analyze JavaScript files
httpx -u target.com -path js/ -match-string "function\|var\|const"

# Look for sensitive information in JS
grep -r "api_key\|password\|secret" js-files/
```

### 6.2 Content Security Policy (CSP) Analysis
```bash
# CSP header analysis
nuclei -u target.com -tags csp

# CSP bypass testing
# (Manual testing with various payloads)
```

## Phase 7: API Security Testing

### 7.1 REST API Testing
```bash
# API endpoint discovery
ffuf -u https://target.com/api/v1/FUZZ -w /usr/share/seclists/Discovery/Web-Content/api/api-endpoints.txt

# GraphQL testing (if applicable)
nuclei -u target.com -tags graphql
```

### 7.2 API Authentication Testing
```bash
# JWT testing
# (Manual analysis of JWT tokens)

# OAuth flow testing
# (Manual testing of OAuth implementation)
```

## Phase 8: Infrastructure Assessment

### 8.1 Web Server Configuration
```bash
# Server misconfiguration detection
nuclei -u target.com -tags config,exposure

# HTTP method testing
nuclei -u target.com -tags http-method
```

### 8.2 Network-Level Assessment
```bash
# Port scanning
nmap -sS -sV -O target.com -oA nmap-scan

# Service enumeration
nmap --script vuln target.com
```

## Reporting

### Generate Reports
```bash
# Create comprehensive report
cd /home/cyberkit/engagements/webapp-test

# Consolidate findings
cat nuclei-vulns.txt web-vulns.txt ssl-assessment.txt > all-vulnerabilities.txt

# Create executive summary
echo "# Web Application Security Assessment Report" > report.md
echo "## Executive Summary" >> report.md
echo "Date: $(date)" >> report.md
echo "Target: target.com" >> report.md
```

## Remediation Verification

### Re-test Critical Findings
```bash
# Re-run specific vulnerability tests
nuclei -u target.com -tags sqli,xss,rce -o retest-results.txt

# Compare with initial findings
diff nuclei-vulns.txt retest-results.txt
```

## Tools Used
- **nuclei** - Vulnerability scanner
- **sqlmap** - SQL injection testing
- **gobuster** - Directory brute-forcing
- **ffuf** - Web fuzzer
- **hydra** - Brute force testing
- **nmap** - Network scanning
- **httpx** - HTTP toolkit
- **subfinder** - Subdomain discovery
- **amass** - Attack surface mapping

## Best Practices
1. Always get proper authorization before testing
2. Use a staging environment when possible
3. Document all findings with proof-of-concept
4. Follow responsible disclosure practices
5. Keep testing methodology consistent
6. Validate findings manually before reporting
7. Provide clear remediation guidance

## Common Pitfalls
- Testing production systems without permission
- Not validating automated tool results
- Missing business logic vulnerabilities
- Inadequate documentation of findings
- Not testing for all OWASP Top 10 categories
- Ignoring client-side security issues